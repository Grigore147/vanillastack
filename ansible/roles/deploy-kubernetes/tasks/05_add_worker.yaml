---
- name: Check if kubeadm has already run
  become: true
  stat:
    path: "/etc/kubernetes/pki/ca.crt"
  register: kubeadm_crt

- name: Join to Kubernetes cluster
  command: >
    kubeadm join --token {{ token }} \
                 --discovery-token-unsafe-skip-ca-verification \
                 {{  loadbalancer_fqdn }}:6443 
  when: not kubeadm_crt.stat.exists or reset_cluster==true

